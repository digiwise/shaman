<link rel="import" href="../../bower_components/polyme/polymer.html" />
<link rel="import" href="../../bower_components/core-icons/core-icons.html" />
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">

<polymer-element name="marked-it"
                 attributes="gfm tables breaks pedantic
                 sanitize smartLists smartypants value">

    <template>

        <style>
            :host {
                position: absolute;
                left: 0;
                width: 100%;
                height: auto;
                color: #707070;
                background-color: rgb(255,255,255);
                box-shadow: inset 1px 1px 5px 1px #d9d9d9;
                z-index: 4;
            }
            #editor {
                padding: 20px;
            }
            paper-fab {
                position: absolute;
                right: -25px;
                bottom: -25px;
                background-color: blue;
            }

        </style>
        <div id="editor" contenteditable="true">{{markedValue}}</div>
        <paper-fab id="save_button" icon="save" style="color: white;" on-click="{{save}}"></paper-fab>
        <content></content>

    </template>

    <script src="../../bower_components/marked/lib/marked.js"></script>
    <script>
        Polymer({
            author: 'Sam Carecho',

            ready: function() {
                this.style.display = 'none';
                //console.log(this.$);
                var _this = this;
                this.markedValue = this.value;

                marked.setOptions({
                    renderer: new marked.Renderer(),
                    gfm: true,
                    tables: true,
                    breaks: false,
                    pedantic: false,
                    sanitize: true,
                    smartLists: true,
                    smartypants: false
                });

                this.$.editor.addEventListener("input", function() {
                    _this.value = marked(this.innerHTML);
                    //_this.value = _this.markedValue;
                }, false);
            },

            valueChanged: function(oldValue, newValue) {
                //this.value = newValue;
                //console.log('valueChanged');
            },

            attached: function() {

            },
            save: function() {
                var elem = this;
                //console.log(this);
                var player = document.timeline.play(new Animation(elem, [
                                {opacity: "0.9"},
                                {opacity: "0.0"}
                        ],
                        {
                            duration: 250, iterations: 1
                        }));
                setTimeout(function(){elem.style.display = 'none';}, 240);
            }
        });

        var editorModel = function(value) {
            this.value = value;
        };

        editorModel.prototype.setValue = function(value) {
            if (value != this.value) {
                this.value = value;
            }
        };

    </script>

</polymer-element>
